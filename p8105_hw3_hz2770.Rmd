---
title: "p8105_hw3_hz2770"
author: "Hao Zheng"
date: "2021/10/16"
output: github_document
---
```{r}
library(tidyverse)
```


## Problem 1

First, load the "instacart" dataset.
```{r}
library(p8105.datasets)
data("instacart")
```


Description of the dataset: The dataset "instacart" contains `rnrows = 1,384,617`, `rncols = 15`. There are 4 character variables: eval_set, product_name, aisle and department. All the other variables are integer variables.


1. Now, we want to see how many aisles are there in the dataset "instacart" and which aisle has the most orders.

```{r}
sum_by_aisle = 
  instacart %>% 
  group_by(aisle) %>% 
  summarise(n_obs = n())

sum_by_aisle

sum_by_aisle %>% 
  filter(min_rank(desc(n_obs))< 2)
```

There are `r 134` aisles in total, and the most items are ordered from the aisle "fresh vegetables", which is `r 150609` in total.



2. Then we try to show the number of items sold in each aisle with a number over 10000 via a scatter plot.
```{r}
filter_sum_by_aisle = 
  sum_by_aisle %>% 
  filter(n_obs > 10000)

filter_sum_by_aisle

filter_sum_by_aisle %>%
  ggplot(aes(x = aisle, y = n_obs)) +
  geom_point() +
  labs(x = NULL, y = NULL) +
  scale_y_continuous(
    breaks = c(20000, 60000, 100000, 140000, 180000),
    labels = c("20000", "60000", "100000", "140000", "180000")
  ) +
  theme(axis.text.x = element_text(angle=90, hjust=1))
```

Then we got that there are 39 aisles in total have more than 10000 items sold, among which, "fresh fruits" and "fresh vegetables" have the most sold.



3. Create a table to show the top three items in aisle "baking ingredients", "dog food care" and "packaged vegetables fruits".
```{r}
final_rank =
  instacart %>%
  filter(
    aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")
    ) %>% 
  group_by(aisle, product_name) %>% 
  summarise(n_obs = n()) %>% 
  filter(min_rank(desc(n_obs)) < 4) %>% 
  mutate(
    rank_in_aisle = min_rank(desc(n_obs))
    ) %>% 
  arrange(aisle, rank_in_aisle) %>% 
  select(aisle, rank_in_aisle, product_name, n_obs)
  
final_rank
```



4. Now, show the mean hour of the day at which Pink Lady Apples and Coffee Ice Cream are ordered on each day of the week.

```{r}
apple_and_coffee = 
  instacart %>%
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>% 
  group_by(product_name, order_dow) %>%  
  summarise(
    mean_hour_of_day = mean(order_hour_of_day, na.rm = TRUE)
    ) %>% 
  pivot_wider( 
    names_from = "order_dow", 
    values_from = "mean_hour_of_day"
    ) 

apple_and_coffee
```



## Problem 2

First, let us load the dataset brfss_smart2010 from the P8105 datasets.
```{r}
data("brfss_smart2010")

head(brfss_smart2010)
```

<!-- First, do some data cleaning. -->
<!-- ```{r} -->
<!-- brfss_smart2010 = -->
<!--   janitor::clean_names(brfss_smart2010) %>% -->
<!--   filter(topic == "Overall Health", -->
<!--          response %in% c("Excellent", "Very good", "Good", "Fair", "Poor")) %>% -->
<!--   mutate( -->
<!--     as.factor(response, levels = (display_oreder)) -->
<!--     ) -->

<!-- head(brfss_smart2010) -->
<!-- ``` -->

<!-- 1. Find the states that were observed at 7 or more locations in 2002. -->
<!-- ```{r} -->
<!-- df = -->
<!-- brfss_smart2010 %>% -->
<!--   filter(year == 2002) %>% -->
<!--   group_by(locationabbr) %>% -->
<!--   filter(count(distinct(locationdesc)) >= 7) -->

<!-- df -->
<!-- ``` -->


## Problem 3

```{r}
getwd()

accel_data = read_csv("./data/accel_data.csv")

head(accel_data)
```

Now, we first clean the data as desired.
```{r}
accel_data =
  accel_data %>% 
  janitor::clean_names() %>% 
  mutate(
    day_type = ifelse(day %in% c("Saturday", "Sunday"), "Weekend", "weekday")
  )

```

