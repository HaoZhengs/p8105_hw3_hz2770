---
title: "p8105_hw3_hz2770"
author: "Hao Zheng"
date: "2021/10/16"
output: github_document
---
```{r}
library(tidyverse)
```


## Problem 1

First, load the "instacart" dataset.
```{r}
library(p8105.datasets)
data("instacart")
```

1. Now, we want to see how many aisles are there in the dataset "instacart" and which aisle has the most orders.

```{r}
sum_by_aisle = 
  instacart %>% 
  group_by(aisle) %>% 
  summarise(n_obs = n())

sum_by_aisle

sum_by_aisle %>% 
  filter(min_rank(desc(n_obs))< 2)
```

There are `r 134` aisles in total, and the most items are ordered from the aisle "fresh vegetables", which is `r 150609` in total.



2. Then we try to show the number of items sold in each aisle with a number over 10000 via a scatter plot.
```{r}
filter_sum_by_aisle = 
  sum_by_aisle %>% 
  filter(n_obs > 10000)

filter_sum_by_aisle

filter_sum_by_aisle %>%
  ggplot(aes(x = aisle, y = n_obs)) +
  geom_point() +
  labs(x = NULL, y = NULL) +
  scale_y_continuous(
    breaks = c(20000, 60000, 100000, 140000, 180000),
    labels = c("20000", "60000", "100000", "140000", "180000")
  ) +
  theme(axis.text.x = element_text(angle=90, hjust=1))
```

Then we got that there are 39 aisles in total have more than 10000 items sold, among which, "fresh fruits" and "fresh vegetables" have the most sold.


3. Create a table to show the top three items in aisle "baking ingredients", "dog food care" and "packaged vegetables fruits".
```{r}
# first filter the top three items for each of the three desired aisles.

bak_ingr_rank = 
  instacart %>% 
  filter(aisle == "baking ingredients") %>%
  group_by(product_name) %>%
  summarise(n_obs = n()) %>% 
  filter(min_rank(desc(n_obs)) < 4) %>% 
  mutate(aisle ="baking ingredients",
         rank_in_aisle = min_rank(desc(n_obs))) %>%
  arrange(desc(n_obs))

bak_ingr_rank

dog_food_rank = 
  instacart %>% 
  filter(aisle == "dog food care") %>%
  group_by(product_name) %>%
  summarise(n_obs = n()) %>% 
  filter(min_rank(desc(n_obs)) < 4) %>% 
  mutate(aisle = "dog food care",
         rank_in_aisle = min_rank(desc(n_obs))) %>%
  arrange(desc(n_obs))

dog_food_rank

pack_veg_rank = 
  instacart %>% 
  filter(aisle == "packaged vegetables fruits") %>%
  group_by(product_name) %>%
  summarise(n_obs = n()) %>% 
  filter(min_rank(desc(n_obs)) < 4) %>% 
  mutate(aisle ="packaged vegetables fruits",
         rank_in_aisle = min_rank(desc(n_obs))) %>%
  arrange(desc(n_obs))

pack_veg_rank

# Bind all the three tables into one and reorder it to make it clearer.
final_rank = 
  bind_rows(bak_ingr_rank, dog_food_rank, pack_veg_rank) %>% 
  select(aisle, rank_in_aisle, product_name, n_obs)

final_rank
```


Try to find is there a easier way to do this. Then I found I can just use group_by() to do this.
```{r}
final_rank_new =
  instacart %>%
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>% 
  group_by(aisle, product_name) %>% 
  summarise(n_obs = n()) %>% 
  filter(min_rank(desc(n_obs)) < 4) %>% 
  mutate(rank_in_aisle = min_rank(desc(n_obs))) %>%
  arrange(rank_in_aisle) %>%
  select(aisle, rank_in_aisle, product_name, n_obs)
  
final_rank_new
```



4. Now, we want to show the mean hour of the day at which Pink Lady Apples and Coffee Ice Cream are ordered on each day of the week.

```{r}
#instacart %>% 
  #group_by(product_name)
```

